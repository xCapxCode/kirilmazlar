<!DOCTYPE html>
<html lang="tr">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Session Management Test</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 40px;
    }

    .test-section {
      margin: 20px 0;
      padding: 20px;
      border: 1px solid #ddd;
    }

    button {
      margin: 10px;
      padding: 10px 20px;
    }

    .status {
      margin-top: 10px;
      padding: 10px;
      background: #f5f5f5;
    }
  </style>
</head>

<body>
  <h1>Session Management & Security Test</h1>

  <div class="test-section">
    <h3>Session Status</h3>
    <button onclick="checkSessionStatus()">Session Status Kontrol Et</button>
    <button onclick="extendSession()">Session'Ä± Uzat</button>
    <div id="sessionStatus" class="status"></div>
  </div>

  <div class="test-section">
    <h3>Session Timeout Test</h3>
    <button onclick="simulateTimeout()">Timeout SimÃ¼lasyonu (5 saniye)</button>
    <button onclick="resetTimeout()">Timeout Reset</button>
    <div id="timeoutStatus" class="status"></div>
  </div>

  <div class="test-section">
    <h3>Concurrent Session Test</h3>
    <button onclick="simulateConcurrentSession()">Concurrent Session SimÃ¼lasyonu</button>
    <button onclick="checkConcurrentSessions()">Concurrent Session Kontrol</button>
    <div id="concurrentStatus" class="status"></div>
  </div>

  <div class="test-section">
    <h3>P1.3.3 Security Tests</h3>
    <button onclick="simulateFailedLogins()">Failed Login SimÃ¼lasyonu</button>
    <button onclick="simulateRapidRequests()">Rapid Requests SimÃ¼lasyonu</button>
    <button onclick="simulateStorageTampering()">Storage Tampering SimÃ¼lasyonu</button>
    <button onclick="checkSecurityStats()">GÃ¼venlik Ä°statistikleri</button>
    <div id="securityStatus" class="status"></div>
  </div>
  <script>
    // Session management iÃ§in yardÄ±mcÄ± fonksiyonlar
    function checkSessionStatus() {
      const sessionData = localStorage.getItem('ofisnet_session');
      const statusDiv = document.getElementById('sessionStatus');

      if (sessionData) {
        const session = JSON.parse(sessionData);
        statusDiv.innerHTML = `
                    <strong>Session Aktif:</strong><br>
                    ID: ${session.sessionId}<br>
                    BaÅŸlangÄ±Ã§: ${new Date(session.startTime).toLocaleString()}<br>
                    Son Aktivite: ${new Date(session.lastActivity).toLocaleString()}<br>
                    Timeout: ${session.timeoutMinutes} dakika
                `;
      } else {
        statusDiv.innerHTML = '<strong>Session bulunamadÄ±</strong>';
      }
    }

    function extendSession() {
      const sessionData = localStorage.getItem('ofisnet_session');
      if (sessionData) {
        const session = JSON.parse(sessionData);
        session.lastActivity = Date.now();
        localStorage.setItem('ofisnet_session', JSON.stringify(session));
        checkSessionStatus();
      }
    }

    function simulateTimeout() {
      const statusDiv = document.getElementById('timeoutStatus');
      statusDiv.innerHTML = 'Timeout test baÅŸlatÄ±ldÄ±...';

      // Session'Ä± 5 saniye Ã¶ncesine ayarla
      const sessionData = localStorage.getItem('ofisnet_session');
      if (sessionData) {
        const session = JSON.parse(sessionData);
        session.lastActivity = Date.now() - (6 * 60 * 1000); // 6 dakika Ã¶nce
        session.timeoutMinutes = 5; // 5 dakikalÄ±k timeout
        localStorage.setItem('ofisnet_session', JSON.stringify(session));
        statusDiv.innerHTML = 'Session timeout simÃ¼lasyonu hazÄ±r. Ana sayfayÄ± yenileyin.';
      } else {
        statusDiv.innerHTML = 'Ã–nce session oluÅŸturun';
      }
    }

    function resetTimeout() {
      extendSession();
      document.getElementById('timeoutStatus').innerHTML = 'Timeout reset edildi';
    }

    function simulateConcurrentSession() {
      const statusDiv = document.getElementById('concurrentStatus');

      // FarklÄ± session ID ile concurrent session simÃ¼lasyonu
      const newSessionId = 'session_' + Math.random().toString(36).substr(2, 9);
      const concurrentSession = {
        sessionId: newSessionId,
        startTime: Date.now(),
        lastActivity: Date.now(),
        timeoutMinutes: 30
      };

      // Concurrent sessions registry'e ekle
      const concurrentSessions = JSON.parse(localStorage.getItem('ofisnet_concurrent_sessions') || '{}');
      concurrentSessions[newSessionId] = {
        startTime: Date.now(),
        lastActivity: Date.now()
      };
      localStorage.setItem('ofisnet_concurrent_sessions', JSON.stringify(concurrentSessions));

      statusDiv.innerHTML = `Concurrent session oluÅŸturuldu: ${newSessionId}`;
    }

    function checkConcurrentSessions() {
      const statusDiv = document.getElementById('concurrentStatus');
      const concurrentSessions = JSON.parse(localStorage.getItem('ofisnet_concurrent_sessions') || '{}');
      const sessionCount = Object.keys(concurrentSessions).length;

      statusDiv.innerHTML = `
                <strong>Aktif Session SayÄ±sÄ±:</strong> ${sessionCount}<br>
                <strong>Sessions:</strong> ${JSON.stringify(concurrentSessions, null, 2)}
            `;
    }

    // Sayfa yÃ¼klendiÄŸinde session status'unu gÃ¶ster
    window.onload = function () {
      checkSessionStatus();
      checkConcurrentSessions();
    }

    // P1.3.3 Security Test Functions
    function simulateFailedLogins() {
      const statusDiv = document.getElementById('securityStatus');
      statusDiv.innerHTML = 'Failed login simÃ¼lasyonu baÅŸlatÄ±lÄ±yor...';

      // Simulate multiple failed login attempts
      for (let i = 0; i < 6; i++) {
        setTimeout(() => {
          // Trigger failed login event
          const event = new CustomEvent('simulatedFailedLogin', {
            detail: { userId: 'test_user', attempt: i + 1 }
          });
          window.dispatchEvent(event);
        }, i * 500);
      }

      statusDiv.innerHTML = 'Failed login simÃ¼lasyonu tamamlandÄ±. Ana sayfayÄ± kontrol edin.';
    }

    function simulateRapidRequests() {
      const statusDiv = document.getElementById('securityStatus');
      statusDiv.innerHTML = 'Rapid requests simÃ¼lasyonu baÅŸlatÄ±lÄ±yor...';

      // Simulate rapid requests
      const event = new CustomEvent('simulatedRapidRequests', {
        detail: { userId: 'test_user', requestCount: 100 }
      });
      window.dispatchEvent(event);

      statusDiv.innerHTML = 'Rapid requests simÃ¼lasyonu tamamlandÄ±. Ana sayfayÄ± kontrol edin.';
    }

    function simulateStorageTampering() {
      const statusDiv = document.getElementById('securityStatus');
      statusDiv.innerHTML = 'Storage tampering simÃ¼lasyonu baÅŸlatÄ±lÄ±yor...';

      // Simulate suspicious localStorage changes
      const originalValue = localStorage.getItem('ofisnet_session');
      localStorage.setItem('ofisnet_session', 'tampered_value');

      setTimeout(() => {
        if (originalValue) {
          localStorage.setItem('ofisnet_session', originalValue);
        } else {
          localStorage.removeItem('ofisnet_session');
        }
      }, 1000);

      statusDiv.innerHTML = 'Storage tampering simÃ¼lasyonu tamamlandÄ±. Ana sayfayÄ± kontrol edin.';
    }

    function checkSecurityStats() {
      const statusDiv = document.getElementById('securityStatus');

      // Get security events from localStorage (if any)
      const securityEvents = JSON.parse(localStorage.getItem('ofisnet_security_events') || '[]');

      statusDiv.innerHTML = `
        <strong>GÃ¼venlik Ä°statistikleri:</strong><br>
        <strong>KayÄ±tlÄ± GÃ¼venlik OlaylarÄ±:</strong> ${securityEvents.length}<br>
        <strong>Son Olay:</strong> ${securityEvents.length > 0 ? new Date(securityEvents[securityEvents.length - 1].timestamp).toLocaleString() : 'Yok'}<br>
        <br>
        Console'u kontrol edin, daha detaylÄ± bilgiler iÃ§in.
      `;

      console.log('ðŸ”’ Security Events:', securityEvents);
    }
  </script>
</body>

</html>